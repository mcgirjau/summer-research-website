<!-- Andrew Moore -->

<!DOCTYPE html>
  <meta charset="utf-8">
    <style>
    
    rect {
      fill: none;
      pointer-events: all;
    }
  
  .node {
    fill: #000;
  }
  
  .node text {
  pointer-events: none;
  font: 14px sans-serif;
}

  .cursor {
    fill: none;
    stroke: brown;
    pointer-events: none;
  }
  
  .link {
    stroke: #999;
  }
  
  </style>
    <body>
    <script src="d3.v3.min.js"></script>
<script>

// Various lower-level stuff to set up the visualization system

var directed = false;
var colortype = "norm"; 
  // "norm" --- color determined by distance from origin 
  // "real" --- color determined by value real component
  // "imaginary" -- color determined by value imaginary component
  
var fastrender = false;

//var width = 960, height = 500;
width  = window.innerWidth;
height = window.innerHeight;

//var color = d3.scale.category20c();
//var color = d3.interpolate("blue","red");

var spectrum = ["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"].reverse();
//var spectrum = ['#d73027','#f46d43','#fdae61','#fee090','#ffffbf','#e0f3f8','#abd9e9','#74add1','#4575b4'].reverse();

function color(x) {
  aboveColor = Math.floor(x+1);
  belowColor = Math.floor(x);
  if(belowColor >= spectrum.length-1) {
    return spectrum[spectrum.length-1];
  }
  if(aboveColor <= 0) {
    return spectrum[0];
  }
  if(x-belowColor < 0.05) {
    return spectrum[belowColor];
  }
  return blend_colors(spectrum[belowColor], spectrum[aboveColor], x-belowColor);
}
  
var svg = d3.select('body').append('svg')
    .attr('width', width)
    .attr('height', height)
    //.style("background-color", '#202020');
svg.append("rect")
    .attr("width", width)
    .attr("height", height)
    
    
var defs = svg.append("defs");

if(directed) {
  defs.selectAll("marker")
    .data(["child"])
    .enter().append("svg:marker")
    .attr("id", String)
    .attr("markerUnits", "userSpaceOnUse")
    .attr("viewBox", "0 -5 10 10")
    .attr("refX", 42) //60
    .attr("refY", 0) //-1.1
    .attr("markerWidth", 8)
    .attr("markerHeight", 8)
    .attr("orient", "auto")
    .style("fill", function(d) { return "white"; })
    .append("svg:path")
    .attr("d", "M0,-5L10,0L0,5");
}


  
// Load & Parse data about the graph

var laplacian = [[[2, 0], [-1, 0], [0, 0], [0, 0], [0, 0], [-1, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0]], [[-1, 0], [3, 0], [-1, 0], [0, 0], [0, 0], [0, 0], [-1, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0]], [[0, 0], [-1, 0], [3, 0], [-1, 0], [0, 0], [0, 0], [0, 0], [-1, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0]], [[0, 0], [0, 0], [-1, 0], [3, 0], [-1, 0], [0, 0], [0, 0], [0, 0], [-1, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0]], [[0, 0], [0, 0], [0, 0], [-1, 0], [2, 0], [0, 0], [0, 0], [0, 0], [0, 0], [-1, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0]], [[-1, 0], [0, 0], [0, 0], [0, 0], [0, 0], [3, 0], [-1, 0], [0, 0], [0, 0], [0, 0], [-1, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0]], [[0, 0], [-1, 0], [0, 0], [0, 0], [0, 0], [-1, 0], [4, 0], [-1, 0], [0, 0], [0, 0], [0, 0], [-1, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0]], [[0, 0], [0, 0], [-1, 0], [0, 0], [0, 0], [0, 0], [-1, 0], [4, 0], [-1, 0], [0, 0], [0, 0], [0, 0], [-1, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0]], [[0, 0], [0, 0], [0, 0], [-1, 0], [0, 0], [0, 0], [0, 0], [-1, 0], [4, 0], [-1, 0], [0, 0], [0, 0], [0, 0], [-1, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0]], [[0, 0], [0, 0], [0, 0], [0, 0], [-1, 0], [0, 0], [0, 0], [0, 0], [-1, 0], [3, 0], [0, 0], [0, 0], [0, 0], [0, 0], [-1, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0]], [[0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [-1, 0], [0, 0], [0, 0], [0, 0], [0, 0], [3, 0], [-1, 0], [0, 0], [0, 0], [0, 0], [-1, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0]], [[0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [-1, 0], [0, 0], [0, 0], [0, 0], [-1, 0], [4, 0], [-1, 0], [0, 0], [0, 0], [0, 0], [-1, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0]], [[0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [-1, 0], [0, 0], [0, 0], [0, 0], [-1, 0], [4, 0], [-1, 0], [0, 0], [0, 0], [0, 0], [-1, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0]], [[0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [-1, 0], [0, 0], [0, 0], [0, 0], [-1, 0], [4, 0], [-1, 0], [0, 0], [0, 0], [0, 0], [-1, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0]], [[0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [-1, 0], [0, 0], [0, 0], [0, 0], [-1, 0], [3, 0], [0, 0], [0, 0], [0, 0], [0, 0], [-1, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0]], [[0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [-1, 0], [0, 0], [0, 0], [0, 0], [0, 0], [3, 0], [-1, 0], [0, 0], [0, 0], [0, 0], [-1, 0], [0, 0], [0, 0], [0, 0], [0, 0]], [[0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [-1, 0], [0, 0], [0, 0], [0, 0], [-1, 0], [4, 0], [-1, 0], [0, 0], [0, 0], [0, 0], [-1, 0], [0, 0], [0, 0], [0, 0]], [[0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [-1, 0], [0, 0], [0, 0], [0, 0], [-1, 0], [4, 0], [-1, 0], [0, 0], [0, 0], [0, 0], [-1, 0], [0, 0], [0, 0]], [[0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [-1, 0], [0, 0], [0, 0], [0, 0], [-1, 0], [4, 0], [-1, 0], [0, 0], [0, 0], [0, 0], [-1, 0], [0, 0]], [[0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [-1, 0], [0, 0], [0, 0], [0, 0], [-1, 0], [3, 0], [0, 0], [0, 0], [0, 0], [0, 0], [-1, 0]], [[0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [-1, 0], [0, 0], [0, 0], [0, 0], [0, 0], [2, 0], [-1, 0], [0, 0], [0, 0], [0, 0]], [[0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [-1, 0], [0, 0], [0, 0], [0, 0], [-1, 0], [3, 0], [-1, 0], [0, 0], [0, 0]], [[0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [-1, 0], [0, 0], [0, 0], [0, 0], [-1, 0], [3, 0], [-1, 0], [0, 0]], [[0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [-1, 0], [0, 0], [0, 0], [0, 0], [-1, 0], [3, 0], [-1, 0]], [[0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [-1, 0], [0, 0], [0, 0], [0, 0], [-1, 0], [2, 0]]];
var V = [[[.0381966, 0], [-.2, 0], [.361803, 0], [.138197, 0], [.102749, 0], [.00199058, 0], [.380423, 0], [-.00936459, 0], [-.261803, 0], [.141421, 0], [-.00572538, 0], [-.323607, 0], [.0491949, 0], [.43525, 0], [.0084967, 0], [-.235114, 0], [-.126536, 0], [.316228, 0], [-.0174655, 0], [.123607, 0], [-.000221307, 0], [.316228, 0], [-.0077991, 0], [-.00811634, 0], [.0151569, 0]], [[-.1, 0], [-.2, 0], [.223607, 0], [-.223607, 0], [-.217625, 0], [.0471485, 0], [.307768, 0], [.0650561, 0], [.1, 0], [-.212132, 0], [.166572, 0], [-.1, 0], [-.205806, 0], [.0513743, 0], [-.216581, 0], [.0726543, 0], [.298496, 0], [-.158114, 0], [-.344281, 0], [-.1, 0], [.223785, 0], [-.316228, 0], [-.0965463, 0], [-.0837267, 0], [-.28944, 0]], [[.123607, 0], [-.2, 0], [0, 0], [0, 0], [.166251, 0], [-.162999, 0], [.190211, 0], [.185471, 0], [.323607, 0], [.141421, 0], [-.321694, 0], [.0381966, 0], [-.363405, 0], [-.268999, 0], [-.274199, 0], [-.117557, 0], [.0358121, 0], [0, 0], [0, 0], [.261803, 0], [-.138665, 0], [0, 0], [.399059, 0], [.125022, 0], [.164841, 0]], [[-.1, 0], [-.2, 0], [-.223607, 0], [.223607, 0], [-.0513743, 0], [.216589, 0], [.0726543, 0], [.305887, 0], [.1, 0], [-.212132, 0], [.166572, 0], [-.1, 0], [-.205806, 0], [-.217625, 0], [.0471162, 0], [-.307768, 0], [-.226872, 0], [.158114, 0], [.344281, 0], [-.1, 0], [.223785, 0], [0, 0], [-.341563, 0], [.267483, 0], [-.00263335, 0]], [[.0381966, 0], [-.2, 0], [-.361803, 0], [-.138197, 0], [0, 0], [-.102729, 0], [0, 0], [.380307, 0], [-.261803, 0], [.141421, 0], [-.00572538, 0], [-.323607, 0], [.0491949, 0], [0, 0], [.435167, 0], [0, 0], [.19816, 0], [-.316228, 0], [.0174655, 0], [.123607, 0], [-.000221307, 0], [0, 0], [.0468495, 0], [-.300663, 0], [.112076, 0]], [[-.1, 0], [-.2, 0], [.223607, 0], [-.223607, 0], [-.217625, 0], [-.0555808, 0], [.307768, 0], [-.0802083, 0], [.1, 0], [-.212132, 0], [-.149396, 0], [-.1, 0], [.23621, 0], [.0513743, 0], [.218587, 0], [.0726543, 0], [-.220293, 0], [-.158114, 0], [.361746, 0], [-.1, 0], [-.223427, 0], [-.316228, 0], [.112145, 0], [.0999593, 0], [.259127, 0]], [[.261803, 0], [-.2, 0], [.138197, 0], [.361803, 0], [.43525, 0], [.00843225, 0], [.235114, 0], [-.00578764, 0], [-.0381966, 0], [.141421, 0], [-.00572538, 0], [.123607, 0], [-.0187908, 0], [-.102749, 0], [-.0020058, 0], [.380423, 0], [.204739, 0], [-.316228, 0], [.0174655, 0], [-.323607, 0], [.000579388, 0], [0, 0], [-.294714, 0], [-.0331793, 0], [.109443, 0]], [[-.323607, 0], [-.2, 0], [0, 0], [0, 0], [-.268999, 0], [.263738, 0], [.117557, 0], [.114628, 0], [-.123607, 0], [.141421, 0], [.310243, 0], [.261803, 0], [-.17639, 0], [-.166251, 0], [-.169465, 0], [.190211, 0], [-.0579451, 0], [0, 0], [0, 0], [.0381966, 0], [-.361871, 0], [.316228, 0], [.0390504, 0], [-.308779, 0], [.127233, 0]], [[.261803, 0], [-.2, 0], [-.138197, 0], [-.361803, 0], [0, 0], [-.435168, 0], [0, 0], [.235043, 0], [-.0381966, 0], [.141421, 0], [-.00572538, 0], [.123607, 0], [-.0187908, 0], [0, 0], [-.102729, 0], [0, 0], [-.320629, 0], [.316228, 0], [-.0174655, 0], [-.323607, 0], [.000579388, 0], [0, 0], [-.104345, 0], [-.091843, 0], [-.274283, 0]], [[-.1, 0], [-.2, 0], [-.223607, 0], [.223607, 0], [.0513743, 0], [.21858, 0], [-.0726543, 0], [.309464, 0], [.1, 0], [-.212132, 0], [-.149396, 0], [-.1, 0], [.23621, 0], [.217625, 0], [.0556129, 0], [.307768, 0], [.104403, 0], [.158114, 0], [-.361746, 0], [-.1, 0], [-.223427, 0], [0, 0], [.247865, 0], [.333842, 0], [-.221519, 0]], [[.123607, 0], [-.2, 0], [0, 0], [0, 0], [.166251, 0], [.16944, 0], [.190211, 0], [-.194836, 0], [.323607, 0], [.141421, 0], [.310243, 0], [.0381966, 0], [.351792, 0], [-.268999, 0], [.263697, 0], [-.117557, 0], [-.162348, 0], [0, 0], [0, 0], [.261803, 0], [.137728, 0], [0, 0], [.190369, 0], [-.0586637, 0], [-.383726, 0]], [[-.323607, 0], [-.2, 0], [0, 0], [0, 0], [-.268999, 0], [-.27416, 0], [.117557, 0], [-.120415, 0], [-.123607, 0], [.141421, 0], [-.321694, 0], [.261803, 0], [.0967908, 0], [-.166251, 0], [.162974, 0], [.190211, 0], [.262684, 0], [0, 0], [0, 0], [.0381966, 0], [.361734, 0], [.316228, 0], [-.0546486, 0], [.292546, 0], [-.0969194, 0]], [[.4, 0], [-.2, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [-.4, 0], [-.565685, 0], [.0229015, 0], [.4, 0], [-.0608083, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [.4, 0], [-.000716163, 0], [0, 0], [0, 0], [0, 0], [0, 0]], [[-.323607, 0], [-.2, 0], [0, 0], [0, 0], [.268999, 0], [.27416, 0], [-.117557, 0], [.120415, 0], [-.123607, 0], [.141421, 0], [-.321694, 0], [.261803, 0], [.0967908, 0], [.166251, 0], [-.162974, 0], [-.190211, 0], [-.262684, 0], [0, 0], [0, 0], [.0381966, 0], [.361734, 0], [-.316228, 0], [.0546486, 0], [-.292546, 0], [.0969194, 0]], [[.123607, 0], [-.2, 0], [0, 0], [0, 0], [-.166251, 0], [-.16944, 0], [-.190211, 0], [.194836, 0], [.323607, 0], [.141421, 0], [.310243, 0], [.0381966, 0], [.351792, 0], [.268999, 0], [-.263697, 0], [.117557, 0], [.162348, 0], [0, 0], [0, 0], [.261803, 0], [.137728, 0], [0, 0], [-.190369, 0], [.0586637, 0], [.383726, 0]], [[-.1, 0], [-.2, 0], [-.223607, 0], [.223607, 0], [-.0513743, 0], [-.21858, 0], [.0726543, 0], [-.309464, 0], [.1, 0], [-.212132, 0], [-.149396, 0], [-.1, 0], [.23621, 0], [-.217625, 0], [-.0556129, 0], [-.307768, 0], [-.104403, 0], [.158114, 0], [-.361746, 0], [-.1, 0], [-.223427, 0], [0, 0], [-.247865, 0], [-.333842, 0], [.221519, 0]], [[.261803, 0], [-.2, 0], [-.138197, 0], [-.361803, 0], [0, 0], [.435168, 0], [0, 0], [-.235043, 0], [-.0381966, 0], [.141421, 0], [-.00572538, 0], [.123607, 0], [-.0187908, 0], [0, 0], [.102729, 0], [0, 0], [.320629, 0], [.316228, 0], [-.0174655, 0], [-.323607, 0], [.000579388, 0], [0, 0], [.104345, 0], [.091843, 0], [.274283, 0]], [[-.323607, 0], [-.2, 0], [0, 0], [0, 0], [.268999, 0], [-.263738, 0], [-.117557, 0], [-.114628, 0], [-.123607, 0], [.141421, 0], [.310243, 0], [.261803, 0], [-.17639, 0], [.166251, 0], [.169465, 0], [-.190211, 0], [.0579451, 0], [0, 0], [0, 0], [.0381966, 0], [-.361871, 0], [-.316228, 0], [-.0390504, 0], [.308779, 0], [-.127233, 0]], [[.261803, 0], [-.2, 0], [.138197, 0], [.361803, 0], [-.43525, 0], [-.00843225, 0], [-.235114, 0], [.00578764, 0], [-.0381966, 0], [.141421, 0], [-.00572538, 0], [.123607, 0], [-.0187908, 0], [.102749, 0], [.0020058, 0], [-.380423, 0], [-.204739, 0], [-.316228, 0], [.0174655, 0], [-.323607, 0], [.000579388, 0], [0, 0], [.294714, 0], [.0331793, 0], [-.109443, 0]], [[-.1, 0], [-.2, 0], [.223607, 0], [-.223607, 0], [.217625, 0], [.0555808, 0], [-.307768, 0], [.0802083, 0], [.1, 0], [-.212132, 0], [-.149396, 0], [-.1, 0], [.23621, 0], [-.0513743, 0], [-.218587, 0], [-.0726543, 0], [.220293, 0], [-.158114, 0], [.361746, 0], [-.1, 0], [-.223427, 0], [.316228, 0], [-.112145, 0], [-.0999593, 0], [-.259127, 0]], [[.0381966, 0], [-.2, 0], [-.361803, 0], [-.138197, 0], [0, 0], [.102729, 0], [0, 0], [-.380307, 0], [-.261803, 0], [.141421, 0], [-.00572538, 0], [-.323607, 0], [.0491949, 0], [0, 0], [-.435167, 0], [0, 0], [-.19816, 0], [-.316228, 0], [.0174655, 0], [.123607, 0], [-.000221307, 0], [0, 0], [-.0468495, 0], [.300663, 0], [-.112076, 0]], [[-.1, 0], [-.2, 0], [-.223607, 0], [.223607, 0], [.0513743, 0], [-.216589, 0], [-.0726543, 0], [-.305887, 0], [.1, 0], [-.212132, 0], [.166572, 0], [-.1, 0], [-.205806, 0], [.217625, 0], [-.0471162, 0], [.307768, 0], [.226872, 0], [.158114, 0], [.344281, 0], [-.1, 0], [.223785, 0], [0, 0], [.341563, 0], [-.267483, 0], [.00263335, 0]], [[.123607, 0], [-.2, 0], [0, 0], [0, 0], [-.166251, 0], [.162999, 0], [-.190211, 0], [-.185471, 0], [.323607, 0], [.141421, 0], [-.321694, 0], [.0381966, 0], [-.363405, 0], [.268999, 0], [.274199, 0], [.117557, 0], [-.0358121, 0], [0, 0], [0, 0], [.261803, 0], [-.138665, 0], [0, 0], [-.399059, 0], [-.125022, 0], [-.164841, 0]], [[-.1, 0], [-.2, 0], [.223607, 0], [-.223607, 0], [.217625, 0], [-.0471485, 0], [-.307768, 0], [-.0650561, 0], [.1, 0], [-.212132, 0], [.166572, 0], [-.1, 0], [-.205806, 0], [-.0513743, 0], [.216581, 0], [-.0726543, 0], [-.298496, 0], [-.158114, 0], [-.344281, 0], [-.1, 0], [.223785, 0], [.316228, 0], [.0965463, 0], [.0837267, 0], [.28944, 0]], [[.0381966, 0], [-.2, 0], [.361803, 0], [.138197, 0], [-.102749, 0], [-.00199058, 0], [-.380423, 0], [.00936459, 0], [-.261803, 0], [.141421, 0], [-.00572538, 0], [-.323607, 0], [.0491949, 0], [-.43525, 0], [-.0084967, 0], [.235114, 0], [.126536, 0], [.316228, 0], [-.0174655, 0], [.123607, 0], [-.000221307, 0], [-.316228, 0], [.0077991, 0], [.00811634, 0], [-.0151569, 0]]];
var D = [[[7.23607, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0]], [[0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0]], [[0, 0], [0, 0], [.763932, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0]], [[0, 0], [0, 0], [0, 0], [5.23607, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0]], [[0, 0], [0, 0], [0, 0], [0, 0], [6.23607, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0]], [[0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [6.23607, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0]], [[0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [.381966, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0]], [[0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [.381966, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0]], [[0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [2.76393, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0]], [[0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [5, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0]], [[0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [5, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0]], [[0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [1.38197, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0]], [[0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [1.38197, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0]], [[0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [1.76393, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0]], [[0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [1.76393, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0]], [[0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [2.61803, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0]], [[0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [2.61803, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0]], [[0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [3, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0]], [[0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [3, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0]], [[0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [3.61803, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0]], [[0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [3.61803, 0], [0, 0], [0, 0], [0, 0], [0, 0]], [[0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [4, 0], [0, 0], [0, 0], [0, 0]], [[0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [4, 0], [0, 0], [0, 0]], [[0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [4, 0], [0, 0]], [[0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [4, 0]]];
var Vinv = [[[.0381966, 0], [-.1, 0], [.123607, 0], [-.1, 0], [.0381966, 0], [-.1, 0], [.261803, 0], [-.323607, 0], [.261803, 0], [-.1, 0], [.123607, 0], [-.323607, 0], [.4, 0], [-.323607, 0], [.123607, 0], [-.1, 0], [.261803, 0], [-.323607, 0], [.261803, 0], [-.1, 0], [.0381966, 0], [-.1, 0], [.123607, 0], [-.1, 0], [.0381966, 0]], [[-.2, -0], [-.2, -0], [-.2, -0], [-.2, -0], [-.2, -0], [-.2, -0], [-.2, -0], [-.2, -0], [-.2, -0], [-.2, -0], [-.2, -0], [-.2, -0], [-.2, -0], [-.2, -0], [-.2, -0], [-.2, -0], [-.2, -0], [-.2, -0], [-.2, -0], [-.2, -0], [-.2, -0], [-.2, -0], [-.2, -0], [-.2, -0], [-.2, -0]], [[.361803, 0], [.223607, 0], [0, 0], [-.223607, 0], [-.361803, 0], [.223607, 0], [.138197, 0], [0, 0], [-.138197, 0], [-.223607, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [-.223607, 0], [-.138197, 0], [0, 0], [.138197, 0], [.223607, 0], [-.361803, 0], [-.223607, 0], [0, 0], [.223607, 0], [.361803, 0]], [[.138197, -0], [-.223607, -0], [0, 0], [.223607, -0], [-.138197, -0], [-.223607, -0], [.361803, -0], [0, 0], [-.361803, -0], [.223607, -0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [.223607, -0], [-.361803, -0], [0, 0], [.361803, -0], [-.223607, -0], [-.138197, -0], [.223607, -0], [0, 0], [-.223607, -0], [.138197, -0]], [[.102749, 0], [-.218621, 0], [.169472, 0], [-.0555912, 0], [.00199096, 0], [-.21663, 0], [.43525, 0], [-.274212, 0], [.00843383, 0], [.0471574, 0], [.163029, 0], [-.263787, 0], [0, 0], [.263787, 0], [-.163029, 0], [-.0471574, 0], [-.00843383, 0], [.274212, 0], [-.43525, 0], [.21663, 0], [-.00199096, 0], [.0555912, 0], [-.169472, 0], [.218621, 0], [-.102749, 0]], [[0, 0], [.051384, -0], [-.166282, -0], [.217666, -0], [-.102768, -0], [-.051384, -0], [0, 0], [.26905, -0], [-.435332, -0], [.217666, -0], [.166282, -0], [-.26905, -0], [0, 0], [.26905, -0], [-.166282, -0], [-.217666, -0], [.435332, -0], [-.26905, -0], [0, 0], [.051384, -0], [.102768, -0], [-.217666, -0], [.166282, -0], [-.051384, -0], [0, 0]], [[.380423, 0], [.309557, 0], [.194895, 0], [.0802327, 0], [.00936743, 0], [.305979, 0], [.235114, 0], [.120452, 0], [.00578939, 0], [-.0650758, 0], [.185528, 0], [.114662, 0], [0, 0], [-.114662, 0], [-.185528, 0], [.0650758, 0], [-.00578939, 0], [-.120452, 0], [-.235114, 0], [-.305979, 0], [-.00936743, 0], [-.0802327, 0], [-.194895, 0], [-.309557, 0], [-.380423, 0]], [[0, 0], [.0726763, -0], [.190269, -0], [.307862, -0], [.380538, -0], [-.0726763, -0], [0, 0], [.117593, -0], [.235185, -0], [.307862, -0], [-.190269, -0], [-.117593, -0], [0, 0], [.117593, -0], [.190269, -0], [-.307862, -0], [-.235185, -0], [-.117593, -0], [0, 0], [.0726763, -0], [-.380538, -0], [-.307862, -0], [-.190269, -0], [-.0726763, -0], [0, 0]], [[-.261803, 0], [.1, 0], [.323607, 0], [.1, 0], [-.261803, 0], [.1, 0], [-.0381966, 0], [-.123607, 0], [-.0381966, 0], [.1, 0], [.323607, 0], [-.123607, 0], [-.4, 0], [-.123607, 0], [.323607, 0], [.1, 0], [-.0381966, 0], [-.123607, 0], [-.0381966, 0], [.1, 0], [-.261803, 0], [.1, 0], [.323607, 0], [.1, 0], [-.261803, 0]], [[.141421, -0], [-.205726, -0], [.128609, -0], [-.205726, -0], [.141421, -0], [-.218538, -0], [.141421, -0], [.154234, -0], [.141421, -0], [-.218538, -0], [.154234, -0], [.128609, -0], [-.565685, -0], [.128609, -0], [.154234, -0], [-.218538, -0], [.141421, -0], [.154234, -0], [.141421, -0], [-.218538, -0], [.141421, -0], [-.205726, -0], [.128609, -0], [-.205726, -0], [.141421, -0]], [[0, 0], [.158244, -0], [-.316487, -0], [.158244, -0], [0, 0], [-.158244, -0], [0, 0], [.316487, -0], [0, 0], [-.158244, -0], [.316487, -0], [-.316487, -0], [0, 0], [-.316487, -0], [.316487, -0], [-.158244, -0], [0, 0], [.316487, -0], [0, 0], [-.158244, -0], [0, 0], [.158244, -0], [-.316487, -0], [.158244, -0], [0, 0]], [[-.323607, -0], [-.134393, -0], [-.0174518, -0], [-.134393, -0], [-.323607, -0], [-.0656074, -0], [.123607, -0], [.240548, -0], [.123607, -0], [-.0656074, -0], [.093845, -0], [.283059, -0], [.4, -0], [.283059, -0], [.093845, -0], [-.0656074, -0], [.123607, -0], [.240548, -0], [.123607, -0], [-.0656074, -0], [-.323607, -0], [-.134393, -0], [-.0174518, -0], [-.134393, -0], [-.323607, -0]], [[0, 0], [-.226236, -0], [-.366058, -0], [-.226236, -0], [0, 0], [.226236, -0], [0, 0], [-.139822, -0], [0, 0], [.226236, -0], [.366058, -0], [.139822, -0], [0, 0], [.139822, -0], [.366058, -0], [.226236, -0], [0, 0], [-.139822, -0], [0, 0], [.226236, -0], [0, 0], [-.226236, -0], [-.366058, -0], [-.226236, -0], [0, 0]], [[.43525, -0], [.0556235, -0], [-.263747, -0], [-.218628, -0], [-.00849832, -0], [.0471252, -0], [-.102749, -0], [-.163005, -0], [.00200618, -0], [.216622, -0], [-.274252, -0], [-.169497, -0], [0, 0], [.169497, -0], [.274252, -0], [-.216622, -0], [-.00200618, -0], [.163005, -0], [.102749, -0], [-.0471252, -0], [.00849832, -0], [.218628, -0], [.263747, -0], [-.0556235, -0], [-.43525, -0]], [[0, 0], [-.217667, -0], [-.269051, -0], [.0513841, -0], [.435333, -0], [.217667, -0], [0, 0], [-.166282, -0], [-.102768, -0], [.0513841, -0], [.269051, -0], [.166282, -0], [0, 0], [-.166282, -0], [-.269051, -0], [-.0513841, -0], [.102768, -0], [.166282, -0], [0, 0], [-.217667, -0], [-.435333, -0], [-.0513841, -0], [.269051, -0], [.217667, -0], [0, 0]], [[-.235114, -0], [-.123872, -0], [-.192624, -0], [-.261375, -0], [-.150133, -0], [.269181, -0], [.380423, -0], [.311671, -0], [.24292, -0], [.354162, -0], [-.0424905, -0], [.0687511, -0], [0, 0], [-.0687511, -0], [.0424905, -0], [-.354162, -0], [-.24292, -0], [-.311671, -0], [-.380423, -0], [-.269181, -0], [.150133, -0], [.261375, -0], [.192624, -0], [.123872, -0], [.235114, -0]], [[0, 0], [.365163, 0], [.13948, 0], [-.0862033, 0], [.27896, 0], [-.365163, 0], [0, 0], [-.225683, 0], [-.451366, 0], [-.0862033, 0], [-.13948, 0], [.225683, 0], [0, 0], [-.225683, 0], [.13948, 0], [.0862033, 0], [.451366, 0], [.225683, 0], [0, 0], [.365163, 0], [-.27896, 0], [.0862033, 0], [-.13948, 0], [-.365163, 0], [0, 0]], [[.316228, 0], [-.177671, 0], [0, 0], [.177671, 0], [-.316228, 0], [-.138557, 0], [-.316228, 0], [0, 0], [.316228, 0], [.138557, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [.138557, 0], [.316228, 0], [0, 0], [-.316228, 0], [-.138557, 0], [-.316228, 0], [.177671, 0], [0, 0], [-.177671, 0], [.316228, 0]], [[0, 0], [-.354094, 0], [0, 0], [.354094, 0], [0, 0], [.354094, 0], [0, 0], [0, 0], [0, 0], [-.354094, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [-.354094, 0], [0, 0], [0, 0], [0, 0], [.354094, 0], [0, 0], [.354094, 0], [0, 0], [-.354094, 0], [0, 0]], [[.123607, -0], [-.0995997, -0], [.261556, -0], [-.0995997, -0], [.123607, -0], [-.1004, -0], [-.323607, -0], [.0375488, -0], [-.323607, -0], [-.1004, -0], [.262051, -0], [.0388444, -0], [.4, -0], [.0388444, -0], [.262051, -0], [-.1004, -0], [-.323607, -0], [.0375488, -0], [-.323607, -0], [-.1004, -0], [.123607, -0], [-.0995997, -0], [.261556, -0], [-.0995997, -0], [.123607, -0]], [[0, 0], [.223607, 0], [-.138197, 0], [.223607, 0], [0, 0], [-.223607, 0], [0, 0], [-.361804, 0], [0, 0], [-.223607, 0], [.138197, 0], [.361804, 0], [0, 0], [.361804, 0], [.138197, 0], [-.223607, 0], [0, 0], [-.361804, 0], [0, 0], [-.223607, 0], [0, 0], [.223607, 0], [-.138197, 0], [.223607, 0], [0, 0]], [[.316228, -0], [-.307844, -0], [.00449143, -0], [-.00319829, -0], [-.0096766, -0], [-.324611, -0], [-.0128749, -0], [.306551, -0], [.00838347, -0], [.0225515, -0], [.0212584, -0], [.325904, -0], [0, 0], [-.325904, -0], [-.0212584, -0], [-.0225515, -0], [-.00838347, -0], [-.306551, -0], [.0128749, -0], [.324611, -0], [.0096766, -0], [.00319829, -0], [-.00449143, -0], [.307844, -0], [-.316228, -0]], [[0, 0], [-.0933066, 0], [.38985, 0], [-.35777, 0], [.061227, 0], [.0933066, 0], [-.296543, 0], [.061227, 0], [-.0933066, 0], [.235316, 0], [.203237, 0], [-.061227, 0], [0, 0], [.061227, 0], [-.203237, 0], [-.235316, 0], [.0933066, 0], [-.061227, 0], [.296543, 0], [-.0933066, 0], [-.061227, 0], [.35777, 0], [-.38985, 0], [.0933066, 0], [0, 0]], [[0, 0], [-.121986, 0], [.125679, 0], [.291234, 0], [-.294928, 0], [.121986, 0], [-.00369363, 0], [-.294928, 0], [-.121986, 0], [.298622, 0], [-.118292, 0], [.294928, 0], [0, 0], [-.294928, 0], [.118292, 0], [-.298622, 0], [.121986, 0], [.294928, 0], [.00369363, 0], [-.121986, 0], [.294928, 0], [-.291234, 0], [-.125679, 0], [.121986, 0], [0, 0]], [[0, 0], [-.288243, 0], [.174193, 0], [.0385872, 0], [.0754633, 0], [.288243, 0], [.11405, 0], [.0754633, 0], [-.288243, 0], [-.189514, 0], [-.402294, 0], [-.0754633, 0], [0, 0], [.0754633, 0], [.402294, 0], [.189514, 0], [.288243, 0], [-.0754633, 0], [-.11405, 0], [-.288243, 0], [-.0754633, 0], [-.0385872, 0], [-.174193, 0], [.288243, 0], [0, 0]]];
  
var psi = [[[1, 0]], [[1, 0]], [[1, 0]], [[1, 0]], [[1, 0]], [[1, 0]], [[1, 0]], [[1, 0]], [[1, 0]], [[1, 0]], [[1, 0]], [[1, 0]], [[10, 0]], [[1, 0]], [[1, 0]], [[1, 0]], [[1, 0]], [[1, 0]], [[1, 0]], [[1, 0]], [[1, 0]], [[1, 0]], [[1, 0]], [[1, 0]], [[1, 0]]]; // column vector (ket)
var time = 0;

nodes = [];
links = [];

for (var i = 0; i < laplacian.length; i++) {
    nodes.push({ x: width/2+getRandomInt(0,20), y: height/2+getRandomInt(0,20), state: psi[i][0], id: i}); //{name: names[i], id: i, reflexive: false, highlighted:false } );
}

if(directed) {
  for (var i = 0; i < laplacian.length; i++) {
      for (var j = 0; j < laplacian.length; j++) {
        if( i != j && laplacian[i][j][0] == -1) {
          links.push( { source: i, target: j } );
        }
      }
  }
}else{
  for (var i = 0; i < laplacian.length; i++) {
      for (var j = i; j < laplacian.length; j++) {
        if( i != j && laplacian[i][j][0] == -1) {
          links.push( { source: i, target: j } );
        }
      }
  }
}


console.log(nodes);
console.log(links);

//console.log(matrixExponential(laplacian,15));

force = d3.layout.force()
    .nodes(nodes)
    .links(links)
    .size([width, height])
    .linkDistance(60)
    .linkStrength(3)
    .charge(-500)
    .gravity(0.01);
    
force.start();

grads = [];
for(var i = 0; i < links.length; i++) {
  d = links[i];
  var id = "S"+d.source.id +"T" + d.target.id;
  
  var grad = defs.append("linearGradient")
    .attr("gradientUnits", "userSpaceOnUse")
    .attr('x2', function(df) { return d.source.x; })
    .attr('y2', function(df) { return d.source.y; })
    .attr('x1', function(df) { return d.target.x; })
    .attr('y1', function(df) { return d.target.y; })
    .attr("id",  id);
    //.attr("gradientTransform", "rotate(" + angle + ")");
  grad.append("stop").attr("offset", "0%").attr("stop-color", color(d.target.state[0]));
  grad.append("stop").attr("offset", "100%").attr("stop-color", color(d.source.state[0]));
  grads.push(grad);
}

/*
nodestyles = [];
for(var i = 0; i < nodes.length; i++) {
  d = nodes[i];
  var st = defs.append("fill");
}*/

/*var node = svg.selectAll('.node')
    .data(nodes)
    .enter().append('circle')
    .attr('class', 'node')
    .attr('r', 5)
    //.attr('opacity',0)
    .attr('cx', function(d) { return d.x; })
    .attr('cy', function(d) { return d.y; })
    .attr('id', function(d) {
      return "N"+d.id;
    })
    .style("fill", function(d){
          var id = "N"+d.id;
          return "url(#" + id + ")";
      })
    .call(force.drag);*/
    
var link = svg.selectAll('.link')
    .data(links)
    .enter().append('line')
    .attr('class', 'link')
    .attr("marker-end", "url(#child)")
    .attr('x1', function(d) { return d.source.x; })
    .attr('y1', function(d) { return d.source.y; })
    .attr('x2', function(d) { return d.target.x; })
    .attr('y2', function(d) { return d.target.y; })
    .style("stroke-width", function(d) { return 10; })
    .style("stroke", function(d){
          var id = "S"+d.source.id +"T" + d.target.id;
          return "url(#" + id + ")";
      });
    
var node = svg.selectAll('.node')
    .data(nodes)
    .enter().append("g")
        .attr("class", "node")
        .call(force.drag);
    
node.append("circle")
        .attr("class", "node")
        .attr("x", function(d) { return d.x; })
        .attr("y", function(d) { return d.y; })
        .attr("r", 5)
        .attr('id', function(d) {
      return "N"+d.id;
    })
    .style("fill", function(d){
          var id = "N"+d.id;
          return "url(#" + id + ")";
      })
    .style("stroke", "black");
    
node.append("text")
        .attr("class", "nodetext")
        .attr("dx", 12)
        .attr("dy", ".35em")
        .text(function(d) { return d.state })
        //.style("fill", "white")
        .attr('id', function(d) {
      return "NT"+d.id;
    });

      
    


    



animationStep = 100;

force.on('tick', visualUpdate);

function visualUpdate() {
  /*node.transition().ease('linear').duration(animationStep)
        .attr('cx', function(d) { return d.x; })
        .attr('cy', function(d) { return d.y; });

    link.transition().ease('linear').duration(animationStep)
        .attr('x1', function(d) { return d.source.x; })
        .attr('y1', function(d) { return d.source.y; })
        .attr('x2', function(d) { return d.target.x; })
        .attr('y2', function(d) { return d.target.y; });*/
        
    link.attr("x1", function(d) { return d.source.x; })
            .attr("y1", function(d) { return d.source.y; })
            .attr("x2", function(d) { return d.target.x; })
            .attr("y2", function(d) { return d.target.y; });
        
    node.attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; });

    for(var i = 0; i < nodes.length; i++) {
      //nodes[i].state = newpsi[i][0];
      //console.log(colortype);
      //console.log(directed);
      if(colortype == "norm") {
        d3.select("#N"+i).style("fill", color(norm(nodes[i].state)));
      }else if(colortype == "real") {
        d3.select("#N"+i).style("fill", color(nodes[i].state[0]));
      }else if(colortype == "imaginary") {
        d3.select("#N"+i).style("fill", color(nodes[i].state[1]));
      }
      if(nodes[i].state[1] >=0) {
        d3.select("#NT"+i).text(Math.floor(nodes[i].state[0]*10)/10 + " + " +  Math.floor(nodes[i].state[1]*10)/10 + "i");
      }else{
        d3.select("#NT"+i).text(Math.floor(nodes[i].state[0]*10)/10 + " - " +  Math.abs(Math.floor(nodes[i].state[1]*10)/10) + "i");
      }
    }

    for(var i = 0; i < links.length; i++) {
      d = links[i];
      var id = "S"+d.source.id +"T" + d.target.id;
      grad = document.getElementById(id);
      grad.setAttribute("x2", d.source.x);
      grad.setAttribute("y2", d.source.y);
      grad.setAttribute("x1", d.target.x);
      grad.setAttribute("y1", d.target.y);
      if(!fastrender) {
        if(colortype == "norm") {
          grad.childNodes[0].setAttribute("stop-color", color(norm(d.target.state))) // 0% stop
          grad.childNodes[1].setAttribute("stop-color", color(norm(d.source.state))) // 100% stop
        }else if(colortype == "real") {
          grad.childNodes[0].setAttribute("stop-color", color(d.target.state[0])) // 0% stop
          grad.childNodes[1].setAttribute("stop-color", color(d.source.state[0])) // 100% stop
        }else if(colortype == "imaginary") {
          grad.childNodes[0].setAttribute("stop-color", color(d.target.state[1])) // 0% stop
          grad.childNodes[1].setAttribute("stop-color", color(d.source.state[1])) // 100% stop
        }
      }else{
        if(colortype == "norm") {
          c = blend_colors(color(norm(d.target.state)), color(norm(d.source.state)), 0.5);
          grad.childNodes[0].setAttribute("stop-color", c) // 0% stop
          grad.childNodes[1].setAttribute("stop-color", c) // 100% stop
        }
      }
    }
    //d3.select(this.parentNode).select("text").text(function(d) {return d.name}); 
}



// Actual calculations, on loop

setInterval(function() {
  // tick animation
    // Old operator---caculuate power of laplacian directly. In these enlightented times, we prefer diagonalization
    //operator = matrixExponential(scalarProduct(laplacian,-time),36);
    console.log("calculation step");
    operator = diagonalExponentialCC(scalarProductCC(D, [0,-time]));
    console.log(operator);
    operator = matrixProductCC(V, matrixProductCC(operator, Vinv));
    console.log(operator);
    newpsi = matrixProductCC(operator,psi);
    console.log(psi);
    console.log(newpsi);
    for(var i = 0; i < nodes.length; i++) {
      nodes[i].state = newpsi[i][0];
    }
    time+=0.02;
    
    visualUpdate();
}, animationStep);






//------------------------------
// Helper functions
//------------------------------


//------------------------------
// MATH
//------------------------------

function getRandomInt(min, max) {
    min = Math.ceil(min);
    max = Math.floor(max);
    return Math.floor(Math.random() * (max - min + 1)) + min;
}

// complex norm
function norm(z) {
  return Math.sqrt(z[0]*z[0] + z[1]*z[1]);
}

// complex multiplication
function FOIL(x, z) {
  var Re = x[0] * z[0] - x[1]*z[1];
  var Im = x[1] * z[0] + x[0]*z[1];
  return [Re, Im];
}

// complex addition
function addCC(x, z) {
  var Re = x[0] + z[0];
  var Im = x[1] + z[1];
  return [Re, Im];
}

// complex exponent
function euler(x) {
  var Re = Math.exp(x[0]) * Math.cos(x[1]);
  var Im = Math.exp(x[0]) * Math.sin(x[1]);
  return [Re, Im];
}

function factorial(n) {
  // why would you ever need to go higher than this? factorials of 0 through 21
  var factorials = [1, 1, 2, 6, 24, 120, 720, 5040, 40320, 362880, 3628800, 39916800, 479001600, 6227020800, 87178291200, 1307674368000, 20922789888000, 355687428096000, 6402373705728000, 121645100408832000, 2432902008176640000, 51090942171709440000];
  if(n < factorials.length) {
    return factorials[n];
  }else{
    return factorial(n-1) * n;
  }
}

// max precision 
function matrixExponential(A, precision) {
  result = identityMatrix(A.length);
  for(var i=1; i<=precision; i++) {
    result = matrixAddition(result, scalarProduct(matrixPower(A, i), 1/factorial(i)));
  }
  return result;
}

function diagonalExponential(D) {
  result = identityMatrix(D.length);
  for(var i=0; i < D.length; i++) {
    result[i][i] = Math.exp(D[i][i]); 
  }
  return result;
}

function diagonalExponentialCC(D) {
  result = identityMatrixCC(D.length);
  for(var i=0; i < D.length; i++) {
    result[i][i] = euler(D[i][i]); 
  }
  return result;
}

function matrixPower(A, n) {
  if(n==0) {
    return identityMatrix(A.length);
  }
  result = A;
  for(var i=1; i<n; i++) {
    result = matrixProduct(result, A);
  }
  return result;
}

function scalarProduct(A, c) {
  result = [];
  for(var i=0; i < A.length; i++) {
    row = [];
    for(var j=0; j < A[0].length; j++) {
      row.push(A[i][j]*c);
    }
    result.push(row);
  }
  return result;
}

function scalarProductCC(A, c) {
  result = [];
  for(var i=0; i < A.length; i++) {
    row = [];
    for(var j=0; j < A[0].length; j++) {
      row.push(FOIL(A[i][j],c));
    }
    result.push(row);
  }
  return result;
}

function matrixAddition(A, B) {
  result = [];
  for(var i=0; i < A.length; i++) {
    row = [];
    for(var j=0; j < A[0].length; j++) {
      row.push(A[i][j] + B[i][j]);
    }
    result.push(row);
  }
  return result;
}

function matrixAdditionCC(A, B) {
  result = [];
  for(var i=0; i < A.length; i++) {
    row = [];
    for(var j=0; j < A[0].length; j++) {
      row.push(addCC(A[i][j],B[i][j]));
    }
    result.push(row);
  }
  return result;
}
  
  
function matrixProduct(A, B) {
  //we'll say that A is a x b and B is c x d
  var a = A.length;
  var b = A[0].length;
  var c = B.length;
  var d = B[0].length;
  
  if(b != c) {
    // dimension mismatch
    return -1;
  }
  
  result = [];
  for(var i=0; i < a; i++) {
    row = [];
    for(var j=0; j < d; j++) {
      // dot product--- A's ith row DOT B's jth column
      sum = 0;
      for(var k=0; k < b; k++) {
        sum += A[i][k] * B[k][j];
      }
      row.push(sum);
    }
    result.push(row);
  }
  return result;
}

function matrixProductCC(A, B) {
  //we'll say that A is a x b and B is c x d
  var a = A.length;
  var b = A[0].length;
  var c = B.length;
  var d = B[0].length;
  
  if(b != c) {
    // dimension mismatch
    return -1;
  }
  
  result = [];
  for(var i=0; i < a; i++) {
    row = [];
    for(var j=0; j < d; j++) {
      // dot product--- A's ith row DOT B's jth column
      sum = [0,0];
      for(var k=0; k < b; k++) {
        sum = addCC(sum, FOIL(A[i][k],B[k][j]));
      }
      row.push(sum);
    }
    result.push(row);
  }
  return result;
}

function identityMatrix(n) {
  result = [];
  for(var i=0; i < n; i++) {
    row = [];
    for(var j=0; j < n; j++) {
      if(i==j) { 
        row.push(1);
      }else{
        row.push(0);
      }
    }
    result.push(row);
  }
  return result;
}

function identityMatrixCC(n) {
  result = [];
  for(var i=0; i < n; i++) {
    row = [];
    for(var j=0; j < n; j++) {
      if(i==j) { 
        row.push([1,0]);
      }else{
        row.push([0,0]);
      }
    }
    result.push(row);
  }
  return result;
}

//------------------------------
// COLORS
//------------------------------

function blend_colors(color1, color2, percentage)
{
    // check input
    color1 = color1 || '#000000';
    color2 = color2 || '#ffffff';
    percentage = percentage || 0.5;

    // 1: validate input, make sure we have provided a valid hex
    if (color1.length != 4 && color1.length != 7)
        throw new error('colors must be provided as hexes');

    if (color2.length != 4 && color2.length != 7)
        throw new error('colors must be provided as hexes');    

    if (percentage > 1 || percentage < 0)
        throw new error('percentage must be between 0 and 1');


    // 2: check to see if we need to convert 3 char hex to 6 char hex, else slice off hash
    //      the three character hex is just a representation of the 6 hex where each character is repeated
    //      ie: #060 => #006600 (green)
    if (color1.length == 4)
        color1 = color1[1] + color1[1] + color1[2] + color1[2] + color1[3] + color1[3];
    else
        color1 = color1.substring(1);
    if (color2.length == 4)
        color2 = color2[1] + color2[1] + color2[2] + color2[2] + color2[3] + color2[3];
    else
        color2 = color2.substring(1);   


    // 3: we have valid input, convert colors to rgb
    color1 = [parseInt(color1[0] + color1[1], 16), parseInt(color1[2] + color1[3], 16), parseInt(color1[4] + color1[5], 16)];
    color2 = [parseInt(color2[0] + color2[1], 16), parseInt(color2[2] + color2[3], 16), parseInt(color2[4] + color2[5], 16)];


    // 4: blend
    var color3 = [ 
        (1 - percentage) * color1[0] + percentage * color2[0], 
        (1 - percentage) * color1[1] + percentage * color2[1], 
        (1 - percentage) * color1[2] + percentage * color2[2]
    ];


    // 5: convert to hex
    color3 = '#' + int_to_hex(color3[0]) + int_to_hex(color3[1]) + int_to_hex(color3[2]);


    // return hex
    return color3;
}

/*
    convert a Number to a two character hex string
    must round, or we will end up with more digits than expected (2)
    note: can also result in single digit, which will need to be padded with a 0 to the left
    @param: num         => the number to conver to hex
    @returns: string    => the hex representation of the provided number
*/
function int_to_hex(num)
{
    var hex = Math.round(num).toString(16);
    if (hex.length == 1)
        hex = '0' + hex;
    return hex;
}
</script>
